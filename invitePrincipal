#!/usr/bin/env python3
import argparse
import script
import urllib.parse
s = script.Script('invitePrincipal', 'adminKeyFile')
s.parser.add_argument('principal')
s.parser.add_argument('--expiry', type=int, default=86400)
s.parser.add_argument('--invitation-code-only', action=argparse.BooleanOptionalAction)
args = s.args()
invite_secret = s.run({
    'principal': args.principal,
    'expiry_seconds': args.expiry,
})['invite_secret']
if args.invitation_code_only:
    print(invite_secret)
else:
    print(args.serviceUrl + 'invite.html#!' + urllib.parse.urlencode({
        'principal': args.principal,
        'secret': invite_secret,
    }))
